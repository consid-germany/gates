"use strict";var o=Object.defineProperty;var S=Object.getOwnPropertyDescriptor;var E=Object.getOwnPropertyNames;var R=Object.prototype.hasOwnProperty;var f=(e,r)=>{for(var n in r)o(e,n,{get:r[n],enumerable:!0})},A=(e,r,n,c)=>{if(r&&typeof r=="object"||typeof r=="function")for(let t of E(r))!R.call(e,t)&&t!==n&&o(e,t,{get:()=>r[t],enumerable:!(c=S(r,t))||c.enumerable});return e};var _=e=>A(o({},"__esModule",{value:!0}),e);var N={};f(N,{handler:()=>h});module.exports=_(N);var i=require("@aws-sdk/client-secrets-manager"),l="AWSPENDING",I="AWSCURRENT",a=d("SECRET_ID"),s=d("X_VERIFY_ORIGIN_HEADER_NAME"),u=new i.SecretsManagerClient,h=async e=>{if(e.headers===void 0||!Object.prototype.hasOwnProperty.call(e.headers,s)||e.headers[s]===void 0)return{isAuthorized:!1};let r=await p();if(r!==void 0&&e.headers[s]==r)return{isAuthorized:!0};let n=await g();return n!==void 0&&e.headers[s]==n?{isAuthorized:!0}:{isAuthorized:!1}};async function p(){try{return(await u.send(new i.GetSecretValueCommand({SecretId:a,VersionStage:l}))).SecretString}catch(e){console.error(e)}}async function g(){try{return(await u.send(new i.GetSecretValueCommand({SecretId:a,VersionStage:I}))).SecretString}catch(e){console.error(e)}}function d(e){let r=process.env[e];if(!r)throw new Error(`${e} environment variable is not set`);return r}0&&(module.exports={handler});
