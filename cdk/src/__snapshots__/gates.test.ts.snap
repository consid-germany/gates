// Vitest Snapshot v1, https://vitest.dev/guide/snapshot.html

exports[`should match snapshot 1`] = `
{
  "Parameters": {
    "BootstrapVersion": {
      "Default": "/cdk-bootstrap/hnb659fds/version",
      "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
  },
  "Resources": {
    "CustomCDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756C81C01536": {
      "DependsOn": [
        "CustomCDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756CServiceRoleDefaultPolicy88902FDF",
        "CustomCDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756CServiceRole89A01265",
      ],
      "Properties": {
        "Code": {
          "S3Bucket": "cdk-hnb659fds-assets-1234567890-eu-central-1",
          "S3Key": "3423a042b818e31c1e34a19d6689ab2e5f9b70fcbe9e71df66f241b20a200bd9.zip",
        },
        "Environment": {
          "Variables": {
            "AWS_CA_BUNDLE": "/etc/pki/ca-trust/extracted/pem/tls-ca-bundle.pem",
          },
        },
        "Handler": "index.handler",
        "Layers": [
          {
            "Ref": "GatesBucketDeploymentAwsCliLayerA5E4E6D7",
          },
        ],
        "Role": {
          "Fn::GetAtt": [
            "CustomCDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756CServiceRole89A01265",
            "Arn",
          ],
        },
        "Runtime": "python3.13",
        "Timeout": 900,
      },
      "Type": "AWS::Lambda::Function",
    },
    "CustomCDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756CServiceRole89A01265": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "CustomCDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756CServiceRoleDefaultPolicy88902FDF": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":s3:::cdk-hnb659fds-assets-1234567890-eu-central-1",
                    ],
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":s3:::cdk-hnb659fds-assets-1234567890-eu-central-1/*",
                    ],
                  ],
                },
              ],
            },
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*",
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "GatesFrontendAssetsBucketE60AF483",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "GatesFrontendAssetsBucketE60AF483",
                          "Arn",
                        ],
                      },
                      "/*",
                    ],
                  ],
                },
              ],
            },
            {
              "Action": [
                "cloudfront:GetInvalidation",
                "cloudfront:CreateInvalidation",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "CustomCDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756CServiceRoleDefaultPolicy88902FDF",
        "Roles": [
          {
            "Ref": "CustomCDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756CServiceRole89A01265",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "CustomS3AutoDeleteObjectsCustomResourceProviderHandler9D90184F": {
      "DependsOn": [
        "CustomS3AutoDeleteObjectsCustomResourceProviderRole3B1BD092",
      ],
      "Properties": {
        "Code": {
          "S3Bucket": "cdk-hnb659fds-assets-1234567890-eu-central-1",
          "S3Key": "faa95a81ae7d7373f3e1f242268f904eb748d8d0fdd306e8a6fe515a1905a7d6.zip",
        },
        "Description": {
          "Fn::Join": [
            "",
            [
              "Lambda function for auto-deleting objects in ",
              {
                "Ref": "GatesFrontendAssetsBucketE60AF483",
              },
              " S3 bucket.",
            ],
          ],
        },
        "Handler": "index.handler",
        "MemorySize": 128,
        "Role": {
          "Fn::GetAtt": [
            "CustomS3AutoDeleteObjectsCustomResourceProviderRole3B1BD092",
            "Arn",
          ],
        },
        "Runtime": "nodejs22.x",
        "Timeout": 900,
      },
      "Type": "AWS::Lambda::Function",
    },
    "CustomS3AutoDeleteObjectsCustomResourceProviderRole3B1BD092": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Sub": "arn:\${AWS::Partition}:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole",
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "GatesApiFunctionF003CA0A": {
      "DependsOn": [
        "GatesApiFunctionServiceRoleDefaultPolicyBE4E8926",
        "GatesApiFunctionServiceRole83DABBDD",
      ],
      "Properties": {
        "Architectures": [
          "arm64",
        ],
        "Code": {
          "S3Bucket": "cdk-hnb659fds-assets-1234567890-eu-central-1",
          "S3Key": "ffed7f8046e77467314c26d035974a9d3ead58b1cf6ab2afd266084de7a4df3e.zip",
        },
        "Environment": {
          "Variables": {
            "GATES_DYNAMO_DB_TABLE_NAME": {
              "Ref": "GatesGatesTable3C4585D6",
            },
          },
        },
        "FunctionName": "gates-api",
        "Handler": "provided",
        "Role": {
          "Fn::GetAtt": [
            "GatesApiFunctionServiceRole83DABBDD",
            "Arn",
          ],
        },
        "Runtime": "provided.al2023",
      },
      "Type": "AWS::Lambda::Function",
    },
    "GatesApiFunctionLogRetentionA0468E8E": {
      "Properties": {
        "LogGroupName": {
          "Fn::Join": [
            "",
            [
              "/aws/lambda/",
              {
                "Ref": "GatesApiFunctionF003CA0A",
              },
            ],
          ],
        },
        "RetentionInDays": 7,
        "ServiceToken": {
          "Fn::GetAtt": [
            "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aFD4BFC8A",
            "Arn",
          ],
        },
      },
      "Type": "Custom::LogRetention",
    },
    "GatesApiFunctionServiceRole83DABBDD": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "GatesApiFunctionServiceRoleDefaultPolicyBE4E8926": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "dynamodb:BatchGetItem",
                "dynamodb:GetRecords",
                "dynamodb:GetShardIterator",
                "dynamodb:Query",
                "dynamodb:GetItem",
                "dynamodb:Scan",
                "dynamodb:ConditionCheckItem",
                "dynamodb:BatchWriteItem",
                "dynamodb:PutItem",
                "dynamodb:UpdateItem",
                "dynamodb:DeleteItem",
                "dynamodb:DescribeTable",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "GatesGatesTable3C4585D6",
                  "Arn",
                ],
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "GatesApiFunctionServiceRoleDefaultPolicyBE4E8926",
        "Roles": [
          {
            "Ref": "GatesApiFunctionServiceRole83DABBDD",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "GatesBucketDeploymentAwsCliLayerA5E4E6D7": {
      "Properties": {
        "Content": {
          "S3Bucket": "cdk-hnb659fds-assets-1234567890-eu-central-1",
          "S3Key": "c49d356cac773d491c5f7ac148995a1181498a8e289429f8612a7f7e3814f535.zip",
        },
        "Description": "/opt/awscli/aws",
      },
      "Type": "AWS::Lambda::LayerVersion",
    },
    "GatesBucketDeploymentCustomResource9BB17594": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "DestinationBucketName": {
          "Ref": "GatesFrontendAssetsBucketE60AF483",
        },
        "DistributionId": {
          "Ref": "GatesWebDistributionCFDistribution5449A610",
        },
        "OutputObjectKeys": true,
        "Prune": true,
        "ServiceToken": {
          "Fn::GetAtt": [
            "CustomCDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756C81C01536",
            "Arn",
          ],
        },
        "SourceBucketNames": [
          "cdk-hnb659fds-assets-1234567890-eu-central-1",
        ],
        "SourceObjectKeys": [
          "c0afadd675a72196d0d95c0cbe90678bf8f9938040a73be10285d753c73ddc8b.zip",
        ],
        "WaitForDistributionInvalidation": true,
      },
      "Type": "Custom::CDKBucketDeployment",
      "UpdateReplacePolicy": "Delete",
    },
    "GatesFrontendAssetsBucketAutoDeleteObjectsCustomResourceC5020104": {
      "DeletionPolicy": "Delete",
      "DependsOn": [
        "GatesFrontendAssetsBucketPolicy5A2B312D",
      ],
      "Properties": {
        "BucketName": {
          "Ref": "GatesFrontendAssetsBucketE60AF483",
        },
        "ServiceToken": {
          "Fn::GetAtt": [
            "CustomS3AutoDeleteObjectsCustomResourceProviderHandler9D90184F",
            "Arn",
          ],
        },
      },
      "Type": "Custom::S3AutoDeleteObjects",
      "UpdateReplacePolicy": "Delete",
    },
    "GatesFrontendAssetsBucketE60AF483": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "OwnershipControls": {
          "Rules": [
            {
              "ObjectOwnership": "BucketOwnerEnforced",
            },
          ],
        },
        "PublicAccessBlockConfiguration": {
          "BlockPublicAcls": true,
          "BlockPublicPolicy": true,
          "IgnorePublicAcls": true,
          "RestrictPublicBuckets": true,
        },
        "Tags": [
          {
            "Key": "aws-cdk:auto-delete-objects",
            "Value": "true",
          },
          {
            "Key": "aws-cdk:cr-owned:663d19b1",
            "Value": "true",
          },
        ],
      },
      "Type": "AWS::S3::Bucket",
      "UpdateReplacePolicy": "Delete",
    },
    "GatesFrontendAssetsBucketPolicy5A2B312D": {
      "Properties": {
        "Bucket": {
          "Ref": "GatesFrontendAssetsBucketE60AF483",
        },
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "s3:PutBucketPolicy",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
              ],
              "Effect": "Allow",
              "Principal": {
                "AWS": {
                  "Fn::GetAtt": [
                    "CustomS3AutoDeleteObjectsCustomResourceProviderRole3B1BD092",
                    "Arn",
                  ],
                },
              },
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "GatesFrontendAssetsBucketE60AF483",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "GatesFrontendAssetsBucketE60AF483",
                          "Arn",
                        ],
                      },
                      "/*",
                    ],
                  ],
                },
              ],
            },
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
              ],
              "Effect": "Allow",
              "Principal": {
                "CanonicalUser": {
                  "Fn::GetAtt": [
                    "GatesOriginAccessIdentity8F67F10C",
                    "S3CanonicalUserId",
                  ],
                },
              },
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "GatesFrontendAssetsBucketE60AF483",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "GatesFrontendAssetsBucketE60AF483",
                          "Arn",
                        ],
                      },
                      "/*",
                    ],
                  ],
                },
              ],
            },
            {
              "Action": "s3:GetObject",
              "Effect": "Allow",
              "Principal": {
                "CanonicalUser": {
                  "Fn::GetAtt": [
                    "GatesOriginAccessIdentity8F67F10C",
                    "S3CanonicalUserId",
                  ],
                },
              },
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    {
                      "Fn::GetAtt": [
                        "GatesFrontendAssetsBucketE60AF483",
                        "Arn",
                      ],
                    },
                    "/*",
                  ],
                ],
              },
            },
          ],
          "Version": "2012-10-17",
        },
      },
      "Type": "AWS::S3::BucketPolicy",
    },
    "GatesGatesTable3C4585D6": {
      "DeletionPolicy": "Retain",
      "Properties": {
        "AttributeDefinitions": [
          {
            "AttributeName": "group",
            "AttributeType": "S",
          },
          {
            "AttributeName": "service_environment",
            "AttributeType": "S",
          },
        ],
        "BillingMode": "PAY_PER_REQUEST",
        "KeySchema": [
          {
            "AttributeName": "group",
            "KeyType": "HASH",
          },
          {
            "AttributeName": "service_environment",
            "KeyType": "RANGE",
          },
        ],
        "Replicas": [
          {
            "Region": "eu-central-1",
          },
        ],
        "TableName": "gates",
      },
      "Type": "AWS::DynamoDB::GlobalTable",
      "UpdateReplacePolicy": "Retain",
    },
    "GatesGitHubHttpApiBE8182E0": {
      "Properties": {
        "Name": "gates-github-api",
        "ProtocolType": "HTTP",
      },
      "Type": "AWS::ApiGatewayV2::Api",
    },
    "GatesGitHubHttpApiDefaultStage993225D6": {
      "Properties": {
        "ApiId": {
          "Ref": "GatesGitHubHttpApiBE8182E0",
        },
        "AutoDeploy": true,
        "StageName": "$default",
      },
      "Type": "AWS::ApiGatewayV2::Stage",
    },
    "GatesGitHubHttpApiGETapigatesgroupserviceenvironmentstate13C9BE87": {
      "Properties": {
        "ApiId": {
          "Ref": "GatesGitHubHttpApiBE8182E0",
        },
        "AuthorizationType": "CUSTOM",
        "AuthorizerId": {
          "Ref": "GatesGitHubHttpApiGitHubJwtAuthorizer8C649E24",
        },
        "RouteKey": "GET /api/gates/{group}/{service}/{environment}/state",
        "Target": {
          "Fn::Join": [
            "",
            [
              "integrations/",
              {
                "Ref": "GatesGitHubHttpApiGETapigatesgroupserviceenvironmentstateApiFunctionGitHubHttpApiIntegration65AA591E",
              },
            ],
          ],
        },
      },
      "Type": "AWS::ApiGatewayV2::Route",
    },
    "GatesGitHubHttpApiGETapigatesgroupserviceenvironmentstateApiFunctionGitHubHttpApiIntegration65AA591E": {
      "Properties": {
        "ApiId": {
          "Ref": "GatesGitHubHttpApiBE8182E0",
        },
        "IntegrationType": "AWS_PROXY",
        "IntegrationUri": {
          "Fn::GetAtt": [
            "GatesApiFunctionF003CA0A",
            "Arn",
          ],
        },
        "PayloadFormatVersion": "2.0",
      },
      "Type": "AWS::ApiGatewayV2::Integration",
    },
    "GatesGitHubHttpApiGETapigatesgroupserviceenvironmentstateApiFunctionGitHubHttpApiIntegrationPermission25193EAA": {
      "Properties": {
        "Action": "lambda:InvokeFunction",
        "FunctionName": {
          "Fn::GetAtt": [
            "GatesApiFunctionF003CA0A",
            "Arn",
          ],
        },
        "Principal": "apigateway.amazonaws.com",
        "SourceArn": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":execute-api:eu-central-1:1234567890:",
              {
                "Ref": "GatesGitHubHttpApiBE8182E0",
              },
              "/*/*/api/gates/{group}/{service}/{environment}/state",
            ],
          ],
        },
      },
      "Type": "AWS::Lambda::Permission",
    },
    "GatesGitHubHttpApiGitHubJwtAuthorizer8C649E24": {
      "Properties": {
        "ApiId": {
          "Ref": "GatesGitHubHttpApiBE8182E0",
        },
        "AuthorizerPayloadFormatVersion": "2.0",
        "AuthorizerResultTtlInSeconds": 300,
        "AuthorizerType": "REQUEST",
        "AuthorizerUri": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":apigateway:eu-central-1:lambda:path/2015-03-31/functions/",
              {
                "Fn::GetAtt": [
                  "GatesGitHubJwtAuthFunctionD9D90D99",
                  "Arn",
                ],
              },
              "/invocations",
            ],
          ],
        },
        "EnableSimpleResponses": true,
        "IdentitySource": [
          "$request.header.Authorization",
        ],
        "Name": "GitHubJwtAuthorizer",
      },
      "Type": "AWS::ApiGatewayV2::Authorizer",
    },
    "GatesGitHubHttpApiPOSTapigates95B9BB65": {
      "Properties": {
        "ApiId": {
          "Ref": "GatesGitHubHttpApiBE8182E0",
        },
        "AuthorizationType": "CUSTOM",
        "AuthorizerId": {
          "Ref": "GatesGitHubHttpApiGitHubJwtAuthorizer8C649E24",
        },
        "RouteKey": "POST /api/gates",
        "Target": {
          "Fn::Join": [
            "",
            [
              "integrations/",
              {
                "Ref": "GatesGitHubHttpApiGETapigatesgroupserviceenvironmentstateApiFunctionGitHubHttpApiIntegration65AA591E",
              },
            ],
          ],
        },
      },
      "Type": "AWS::ApiGatewayV2::Route",
    },
    "GatesGitHubHttpApiPOSTapigatesApiFunctionGitHubHttpApiIntegrationPermissionF6C3CA19": {
      "Properties": {
        "Action": "lambda:InvokeFunction",
        "FunctionName": {
          "Fn::GetAtt": [
            "GatesApiFunctionF003CA0A",
            "Arn",
          ],
        },
        "Principal": "apigateway.amazonaws.com",
        "SourceArn": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":execute-api:eu-central-1:1234567890:",
              {
                "Ref": "GatesGitHubHttpApiBE8182E0",
              },
              "/*/*/api/gates",
            ],
          ],
        },
      },
      "Type": "AWS::Lambda::Permission",
    },
    "GatesGitHubHttpApiStackGatesGitHubHttpApiGitHubJwtAuthorizer7408D87BPermissionFC7763AC": {
      "Properties": {
        "Action": "lambda:InvokeFunction",
        "FunctionName": {
          "Fn::GetAtt": [
            "GatesGitHubJwtAuthFunctionD9D90D99",
            "Arn",
          ],
        },
        "Principal": "apigateway.amazonaws.com",
        "SourceArn": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":execute-api:eu-central-1:1234567890:",
              {
                "Ref": "GatesGitHubHttpApiBE8182E0",
              },
              "/authorizers/",
              {
                "Ref": "GatesGitHubHttpApiGitHubJwtAuthorizer8C649E24",
              },
            ],
          ],
        },
      },
      "Type": "AWS::Lambda::Permission",
    },
    "GatesGitHubJwtAuthFunctionD9D90D99": {
      "DependsOn": [
        "GatesGitHubJwtAuthFunctionServiceRole3FCC35B4",
      ],
      "Properties": {
        "Code": {
          "S3Bucket": "cdk-hnb659fds-assets-1234567890-eu-central-1",
          "S3Key": "ab4caf6280b1febad72eb59883927ad7609b4e1127c0851e9e333ff8eb6d7bc8.zip",
        },
        "Environment": {
          "Variables": {
            "ALLOWED_SUB_PATTERNS": "["repo:consid-germany/gates:*"]",
          },
        },
        "FunctionName": "gates-github-jwt-auth",
        "Handler": "index.handler",
        "Role": {
          "Fn::GetAtt": [
            "GatesGitHubJwtAuthFunctionServiceRole3FCC35B4",
            "Arn",
          ],
        },
        "Runtime": "nodejs20.x",
      },
      "Type": "AWS::Lambda::Function",
    },
    "GatesGitHubJwtAuthFunctionLogRetention6879C75B": {
      "Properties": {
        "LogGroupName": {
          "Fn::Join": [
            "",
            [
              "/aws/lambda/",
              {
                "Ref": "GatesGitHubJwtAuthFunctionD9D90D99",
              },
            ],
          ],
        },
        "RetentionInDays": 7,
        "ServiceToken": {
          "Fn::GetAtt": [
            "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aFD4BFC8A",
            "Arn",
          ],
        },
      },
      "Type": "Custom::LogRetention",
    },
    "GatesGitHubJwtAuthFunctionServiceRole3FCC35B4": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "GatesHttpApi627E4AAB": {
      "Properties": {
        "Name": "gates-api",
        "ProtocolType": "HTTP",
      },
      "Type": "AWS::ApiGatewayV2::Api",
    },
    "GatesHttpApiDefaultRoute1B5C358E": {
      "Properties": {
        "ApiId": {
          "Ref": "GatesHttpApi627E4AAB",
        },
        "AuthorizationType": "CUSTOM",
        "AuthorizerId": {
          "Ref": "GatesHttpApiVerifyOriginAuthorizer1F98DA52",
        },
        "RouteKey": "$default",
        "Target": {
          "Fn::Join": [
            "",
            [
              "integrations/",
              {
                "Ref": "GatesHttpApiDefaultRouteApiFunctionApiIntegration707B1703",
              },
            ],
          ],
        },
      },
      "Type": "AWS::ApiGatewayV2::Route",
    },
    "GatesHttpApiDefaultRouteApiFunctionApiIntegration707B1703": {
      "Properties": {
        "ApiId": {
          "Ref": "GatesHttpApi627E4AAB",
        },
        "IntegrationType": "AWS_PROXY",
        "IntegrationUri": {
          "Fn::GetAtt": [
            "GatesApiFunctionF003CA0A",
            "Arn",
          ],
        },
        "PayloadFormatVersion": "2.0",
      },
      "Type": "AWS::ApiGatewayV2::Integration",
    },
    "GatesHttpApiDefaultRouteApiFunctionApiIntegrationPermissionD6FACAB0": {
      "Properties": {
        "Action": "lambda:InvokeFunction",
        "FunctionName": {
          "Fn::GetAtt": [
            "GatesApiFunctionF003CA0A",
            "Arn",
          ],
        },
        "Principal": "apigateway.amazonaws.com",
        "SourceArn": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":execute-api:eu-central-1:1234567890:",
              {
                "Ref": "GatesHttpApi627E4AAB",
              },
              "/*/*",
            ],
          ],
        },
      },
      "Type": "AWS::Lambda::Permission",
    },
    "GatesHttpApiDefaultStageC45E17FD": {
      "Properties": {
        "ApiId": {
          "Ref": "GatesHttpApi627E4AAB",
        },
        "AutoDeploy": true,
        "StageName": "$default",
      },
      "Type": "AWS::ApiGatewayV2::Stage",
    },
    "GatesHttpApiStackGatesHttpApiVerifyOriginAuthorizerFF3F7F8APermissionC7C6689F": {
      "Properties": {
        "Action": "lambda:InvokeFunction",
        "FunctionName": {
          "Fn::GetAtt": [
            "GatesVerifyOriginAuthFunctionD0559F11",
            "Arn",
          ],
        },
        "Principal": "apigateway.amazonaws.com",
        "SourceArn": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":execute-api:eu-central-1:1234567890:",
              {
                "Ref": "GatesHttpApi627E4AAB",
              },
              "/authorizers/",
              {
                "Ref": "GatesHttpApiVerifyOriginAuthorizer1F98DA52",
              },
            ],
          ],
        },
      },
      "Type": "AWS::Lambda::Permission",
    },
    "GatesHttpApiVerifyOriginAuthorizer1F98DA52": {
      "Properties": {
        "ApiId": {
          "Ref": "GatesHttpApi627E4AAB",
        },
        "AuthorizerPayloadFormatVersion": "2.0",
        "AuthorizerResultTtlInSeconds": 300,
        "AuthorizerType": "REQUEST",
        "AuthorizerUri": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":apigateway:eu-central-1:lambda:path/2015-03-31/functions/",
              {
                "Fn::GetAtt": [
                  "GatesVerifyOriginAuthFunctionD0559F11",
                  "Arn",
                ],
              },
              "/invocations",
            ],
          ],
        },
        "EnableSimpleResponses": true,
        "IdentitySource": [
          "$request.header.x-verify-origin",
        ],
        "Name": "VerifyOriginAuthorizer",
      },
      "Type": "AWS::ApiGatewayV2::Authorizer",
    },
    "GatesOriginAccessIdentity8F67F10C": {
      "Properties": {
        "CloudFrontOriginAccessIdentityConfig": {
          "Comment": "Allows CloudFront to reach the bucket",
        },
      },
      "Type": "AWS::CloudFront::CloudFrontOriginAccessIdentity",
    },
    "GatesVerifyOriginAuthFunctionD0559F11": {
      "DependsOn": [
        "GatesVerifyOriginAuthFunctionServiceRoleDefaultPolicy2AB27DCE",
        "GatesVerifyOriginAuthFunctionServiceRole9C769B25",
      ],
      "Properties": {
        "Code": {
          "S3Bucket": "cdk-hnb659fds-assets-1234567890-eu-central-1",
          "S3Key": "eac6f2bf5ca35bca631026213cbf581ef34e29fbae693e90883181199fcc3eba.zip",
        },
        "Environment": {
          "Variables": {
            "SECRET_ID": {
              "Fn::Join": [
                "-",
                [
                  {
                    "Fn::Select": [
                      0,
                      {
                        "Fn::Split": [
                          "-",
                          {
                            "Fn::Select": [
                              6,
                              {
                                "Fn::Split": [
                                  ":",
                                  {
                                    "Ref": "GatesVerifyOriginSecret18F23E34",
                                  },
                                ],
                              },
                            ],
                          },
                        ],
                      },
                    ],
                  },
                  {
                    "Fn::Select": [
                      1,
                      {
                        "Fn::Split": [
                          "-",
                          {
                            "Fn::Select": [
                              6,
                              {
                                "Fn::Split": [
                                  ":",
                                  {
                                    "Ref": "GatesVerifyOriginSecret18F23E34",
                                  },
                                ],
                              },
                            ],
                          },
                        ],
                      },
                    ],
                  },
                  {
                    "Fn::Select": [
                      2,
                      {
                        "Fn::Split": [
                          "-",
                          {
                            "Fn::Select": [
                              6,
                              {
                                "Fn::Split": [
                                  ":",
                                  {
                                    "Ref": "GatesVerifyOriginSecret18F23E34",
                                  },
                                ],
                              },
                            ],
                          },
                        ],
                      },
                    ],
                  },
                  {
                    "Fn::Select": [
                      3,
                      {
                        "Fn::Split": [
                          "-",
                          {
                            "Fn::Select": [
                              6,
                              {
                                "Fn::Split": [
                                  ":",
                                  {
                                    "Ref": "GatesVerifyOriginSecret18F23E34",
                                  },
                                ],
                              },
                            ],
                          },
                        ],
                      },
                    ],
                  },
                ],
              ],
            },
            "X_VERIFY_ORIGIN_HEADER_NAME": "x-verify-origin",
          },
        },
        "FunctionName": "gates-verify-origin-auth",
        "Handler": "index.handler",
        "Role": {
          "Fn::GetAtt": [
            "GatesVerifyOriginAuthFunctionServiceRole9C769B25",
            "Arn",
          ],
        },
        "Runtime": "nodejs24.x",
      },
      "Type": "AWS::Lambda::Function",
    },
    "GatesVerifyOriginAuthFunctionLogRetention4036C0AB": {
      "Properties": {
        "LogGroupName": {
          "Fn::Join": [
            "",
            [
              "/aws/lambda/",
              {
                "Ref": "GatesVerifyOriginAuthFunctionD0559F11",
              },
            ],
          ],
        },
        "RetentionInDays": 7,
        "ServiceToken": {
          "Fn::GetAtt": [
            "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aFD4BFC8A",
            "Arn",
          ],
        },
      },
      "Type": "Custom::LogRetention",
    },
    "GatesVerifyOriginAuthFunctionServiceRole9C769B25": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "GatesVerifyOriginAuthFunctionServiceRoleDefaultPolicy2AB27DCE": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "GatesVerifyOriginSecret18F23E34",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "GatesVerifyOriginAuthFunctionServiceRoleDefaultPolicy2AB27DCE",
        "Roles": [
          {
            "Ref": "GatesVerifyOriginAuthFunctionServiceRole9C769B25",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "GatesVerifyOriginSecret18F23E34": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "GenerateSecretString": {
          "ExcludePunctuation": true,
        },
        "Name": "gates-verify-origin-secret",
      },
      "Type": "AWS::SecretsManager::Secret",
      "UpdateReplacePolicy": "Delete",
    },
    "GatesVerifyOriginSecretPolicy31E5281D": {
      "Properties": {
        "ResourcePolicy": {
          "Statement": [
            {
              "Action": "secretsmanager:DeleteSecret",
              "Effect": "Deny",
              "Principal": {
                "AWS": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":iam::1234567890:root",
                    ],
                  ],
                },
              },
              "Resource": "*",
            },
          ],
          "Version": "2012-10-17",
        },
        "SecretId": {
          "Ref": "GatesVerifyOriginSecret18F23E34",
        },
      },
      "Type": "AWS::SecretsManager::ResourcePolicy",
    },
    "GatesVerifyOriginSecretRotationFunctionC6EDE179": {
      "DependsOn": [
        "GatesVerifyOriginSecretRotationFunctionServiceRoleDefaultPolicy636B9A18",
        "GatesVerifyOriginSecretRotationFunctionServiceRoleFE1D56C1",
      ],
      "Properties": {
        "Code": {
          "S3Bucket": "cdk-hnb659fds-assets-1234567890-eu-central-1",
          "S3Key": "bc1b88360ecd0bd71581a05ed8c5c87d2a5938919a0148068dc400f01f0559f7.zip",
        },
        "Environment": {
          "Variables": {
            "CLOUDFRONT_DISTRIBUTION_ID": {
              "Ref": "GatesWebDistributionCFDistribution5449A610",
            },
            "ORIGIN_TEST_URL": {
              "Fn::Join": [
                "",
                [
                  "https://",
                  {
                    "Ref": "GatesHttpApi627E4AAB",
                  },
                  ".execute-api.eu-central-1.amazonaws.com/api/",
                ],
              ],
            },
            "X_VERIFY_ORIGIN_HEADER_NAME": "x-verify-origin",
          },
        },
        "FunctionName": {
          "Fn::Join": [
            "",
            [
              {
                "Fn::Join": [
                  "-",
                  [
                    {
                      "Fn::Select": [
                        0,
                        {
                          "Fn::Split": [
                            "-",
                            {
                              "Fn::Select": [
                                6,
                                {
                                  "Fn::Split": [
                                    ":",
                                    {
                                      "Ref": "GatesVerifyOriginSecret18F23E34",
                                    },
                                  ],
                                },
                              ],
                            },
                          ],
                        },
                      ],
                    },
                    {
                      "Fn::Select": [
                        1,
                        {
                          "Fn::Split": [
                            "-",
                            {
                              "Fn::Select": [
                                6,
                                {
                                  "Fn::Split": [
                                    ":",
                                    {
                                      "Ref": "GatesVerifyOriginSecret18F23E34",
                                    },
                                  ],
                                },
                              ],
                            },
                          ],
                        },
                      ],
                    },
                    {
                      "Fn::Select": [
                        2,
                        {
                          "Fn::Split": [
                            "-",
                            {
                              "Fn::Select": [
                                6,
                                {
                                  "Fn::Split": [
                                    ":",
                                    {
                                      "Ref": "GatesVerifyOriginSecret18F23E34",
                                    },
                                  ],
                                },
                              ],
                            },
                          ],
                        },
                      ],
                    },
                    {
                      "Fn::Select": [
                        3,
                        {
                          "Fn::Split": [
                            "-",
                            {
                              "Fn::Select": [
                                6,
                                {
                                  "Fn::Split": [
                                    ":",
                                    {
                                      "Ref": "GatesVerifyOriginSecret18F23E34",
                                    },
                                  ],
                                },
                              ],
                            },
                          ],
                        },
                      ],
                    },
                  ],
                ],
              },
              "-rotation",
            ],
          ],
        },
        "Handler": "index.handler",
        "Role": {
          "Fn::GetAtt": [
            "GatesVerifyOriginSecretRotationFunctionServiceRoleFE1D56C1",
            "Arn",
          ],
        },
        "Runtime": "nodejs24.x",
        "Timeout": 30,
      },
      "Type": "AWS::Lambda::Function",
    },
    "GatesVerifyOriginSecretRotationFunctionInvokeN0a2GKfZP0JmDqDEVhhu6A0TUv3NyNbk4YMFKNc46D90F48": {
      "Properties": {
        "Action": "lambda:InvokeFunction",
        "FunctionName": {
          "Fn::GetAtt": [
            "GatesVerifyOriginSecretRotationFunctionC6EDE179",
            "Arn",
          ],
        },
        "Principal": "secretsmanager.amazonaws.com",
      },
      "Type": "AWS::Lambda::Permission",
    },
    "GatesVerifyOriginSecretRotationFunctionLogRetentionDBB13CD2": {
      "Properties": {
        "LogGroupName": {
          "Fn::Join": [
            "",
            [
              "/aws/lambda/",
              {
                "Ref": "GatesVerifyOriginSecretRotationFunctionC6EDE179",
              },
            ],
          ],
        },
        "RetentionInDays": 7,
        "ServiceToken": {
          "Fn::GetAtt": [
            "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aFD4BFC8A",
            "Arn",
          ],
        },
      },
      "Type": "Custom::LogRetention",
    },
    "GatesVerifyOriginSecretRotationFunctionServiceRoleDefaultPolicy636B9A18": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "cloudfront:GetDistribution",
                "cloudfront:GetDistributionConfig",
                "cloudfront:UpdateDistribution",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":cloudfront::1234567890:distribution/",
                    {
                      "Ref": "GatesWebDistributionCFDistribution5449A610",
                    },
                  ],
                ],
              },
            },
            {
              "Action": [
                "secretsmanager:DescribeSecret",
                "secretsmanager:GetSecretValue",
                "secretsmanager:PutSecretValue",
                "secretsmanager:UpdateSecretVersionStage",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "GatesVerifyOriginSecret18F23E34",
              },
            },
            {
              "Action": "secretsmanager:GetRandomPassword",
              "Effect": "Allow",
              "Resource": "*",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "GatesVerifyOriginSecretRotationFunctionServiceRoleDefaultPolicy636B9A18",
        "Roles": [
          {
            "Ref": "GatesVerifyOriginSecretRotationFunctionServiceRoleFE1D56C1",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "GatesVerifyOriginSecretRotationFunctionServiceRoleFE1D56C1": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "GatesVerifyOriginSecretRotationScheduleFDB62406": {
      "DependsOn": [
        "GatesVerifyOriginSecretRotationFunctionInvokeN0a2GKfZP0JmDqDEVhhu6A0TUv3NyNbk4YMFKNc46D90F48",
      ],
      "Properties": {
        "RotationLambdaARN": {
          "Fn::GetAtt": [
            "GatesVerifyOriginSecretRotationFunctionC6EDE179",
            "Arn",
          ],
        },
        "RotationRules": {
          "ScheduleExpression": "rate(1 day)",
        },
        "SecretId": {
          "Ref": "GatesVerifyOriginSecret18F23E34",
        },
      },
      "Type": "AWS::SecretsManager::RotationSchedule",
    },
    "GatesWebDistributionCFDistribution5449A610": {
      "Properties": {
        "DistributionConfig": {
          "CacheBehaviors": [
            {
              "AllowedMethods": [
                "DELETE",
                "GET",
                "HEAD",
                "OPTIONS",
                "PATCH",
                "POST",
                "PUT",
              ],
              "CachedMethods": [
                "GET",
                "HEAD",
              ],
              "Compress": true,
              "DefaultTTL": 0,
              "ForwardedValues": {
                "Cookies": {
                  "Forward": "none",
                },
                "QueryString": false,
              },
              "PathPattern": "/api",
              "TargetOriginId": "origin1",
              "ViewerProtocolPolicy": "redirect-to-https",
            },
            {
              "AllowedMethods": [
                "DELETE",
                "GET",
                "HEAD",
                "OPTIONS",
                "PATCH",
                "POST",
                "PUT",
              ],
              "CachedMethods": [
                "GET",
                "HEAD",
              ],
              "Compress": true,
              "DefaultTTL": 0,
              "ForwardedValues": {
                "Cookies": {
                  "Forward": "none",
                },
                "QueryString": false,
              },
              "PathPattern": "/api/*",
              "TargetOriginId": "origin1",
              "ViewerProtocolPolicy": "redirect-to-https",
            },
          ],
          "DefaultCacheBehavior": {
            "AllowedMethods": [
              "GET",
              "HEAD",
              "OPTIONS",
            ],
            "CachedMethods": [
              "GET",
              "HEAD",
            ],
            "Compress": true,
            "ForwardedValues": {
              "Cookies": {
                "Forward": "none",
              },
              "QueryString": false,
            },
            "TargetOriginId": "origin2",
            "ViewerProtocolPolicy": "redirect-to-https",
          },
          "DefaultRootObject": "index.html",
          "Enabled": true,
          "HttpVersion": "http2",
          "IPV6Enabled": false,
          "Origins": [
            {
              "ConnectionAttempts": 3,
              "ConnectionTimeout": 10,
              "CustomOriginConfig": {
                "HTTPPort": 80,
                "HTTPSPort": 443,
                "OriginKeepaliveTimeout": 5,
                "OriginProtocolPolicy": "https-only",
                "OriginReadTimeout": 30,
                "OriginSSLProtocols": [
                  "TLSv1.2",
                ],
              },
              "DomainName": {
                "Fn::Join": [
                  "",
                  [
                    {
                      "Ref": "GatesHttpApi627E4AAB",
                    },
                    ".execute-api.eu-central-1.amazonaws.com",
                  ],
                ],
              },
              "Id": "origin1",
              "OriginCustomHeaders": [
                {
                  "HeaderName": "x-verify-origin",
                  "HeaderValue": {
                    "Fn::Join": [
                      "",
                      [
                        "{{resolve:secretsmanager:",
                        {
                          "Ref": "GatesVerifyOriginSecret18F23E34",
                        },
                        ":SecretString:::}}",
                      ],
                    ],
                  },
                },
              ],
            },
            {
              "ConnectionAttempts": 3,
              "ConnectionTimeout": 10,
              "DomainName": {
                "Fn::GetAtt": [
                  "GatesFrontendAssetsBucketE60AF483",
                  "RegionalDomainName",
                ],
              },
              "Id": "origin2",
              "S3OriginConfig": {
                "OriginAccessIdentity": {
                  "Fn::Join": [
                    "",
                    [
                      "origin-access-identity/cloudfront/",
                      {
                        "Ref": "GatesOriginAccessIdentity8F67F10C",
                      },
                    ],
                  ],
                },
              },
            },
          ],
          "PriceClass": "PriceClass_100",
          "ViewerCertificate": {
            "CloudFrontDefaultCertificate": true,
          },
        },
      },
      "Type": "AWS::CloudFront::Distribution",
    },
    "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aFD4BFC8A": {
      "DependsOn": [
        "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aServiceRoleDefaultPolicyADDA7DEB",
        "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aServiceRole9741ECFB",
      ],
      "Properties": {
        "Code": {
          "S3Bucket": "cdk-hnb659fds-assets-1234567890-eu-central-1",
          "S3Key": "2819175352ad1ce0dae768e83fc328fb70fb5f10b4a8ff0ccbcb791f02b0716d.zip",
        },
        "Handler": "index.handler",
        "Role": {
          "Fn::GetAtt": [
            "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aServiceRole9741ECFB",
            "Arn",
          ],
        },
        "Runtime": "nodejs22.x",
        "Timeout": 900,
      },
      "Type": "AWS::Lambda::Function",
    },
    "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aServiceRole9741ECFB": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aServiceRoleDefaultPolicyADDA7DEB": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "logs:PutRetentionPolicy",
                "logs:DeleteRetentionPolicy",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aServiceRoleDefaultPolicyADDA7DEB",
        "Roles": [
          {
            "Ref": "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aServiceRole9741ECFB",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
  },
  "Rules": {
    "CheckBootstrapVersion": {
      "Assertions": [
        {
          "Assert": {
            "Fn::Not": [
              {
                "Fn::Contains": [
                  [
                    "1",
                    "2",
                    "3",
                    "4",
                    "5",
                  ],
                  {
                    "Ref": "BootstrapVersion",
                  },
                ],
              },
            ],
          },
          "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI.",
        },
      ],
    },
  },
}
`;
